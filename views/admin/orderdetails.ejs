<%-include("../layouts/admin/sideBar.ejs")-%>
<%-include("../layouts/admin/adminHeader.ejs")-%>

<div class="main-panel">
  <div class="content-wrapper">
    <div class="row">
<div class="col-lg-12">
  <div class="container-fluid ml">

    <div class="container">
      <!-- Title -->
      <div class="d-flex justify-content-center align-items-center py-3">
       
      </div>
    
      <!-- Main content -->
      <div class="row d-flex justify-content-center">
        <div class="col-lg-8">
          <!-- Details -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="mb-3 d-flex justify-content-between">
                
               
              </div>
              <table class="table text-white">
                <tbody>
                  <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                  </tr>
                  <%orderDetails.products.forEach((details)=>{%>
                    <tr>
                      <td>
                        <div class="d-flex mb-2">
                          <div class="flex-shrink-0">
                            <img src="/product/img/<%=details.productId.image.image1%>" alt="" width="35" class="img-fluid">
                          </div>
                          <div class="flex-lg-grow-1 ms-3">
                            <h6 class="small mb-0"> <a style="text-decoration: none;" class="text-reset" ><%=details.productId.name%></a></h6>
                            <!-- <h6 class="small mb-0"><a style="text-decoration: none;" class="text-reset">Qty : <%=details.count%></a></h6> -->
                          </div>
                        </div>
                      </td>
                      <td><%=details.count%></td>
  
                      <td class="text-end">₹<%=details.productId.price%></td>
                    </tr>
                  <%})%>
                  
                  
                </tbody>
                <tfoot>
                  
                  
                 
                  <tr class="fw-bold">
                    <td colspan="2">TOTAL</td>
                    <td class="text-end">₹<%=orderDetails.totalAmount%></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
          <!-- Payment -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="row">
                <div class="col-lg-6">
                  <h3 class="h6">Payment Method</h3>
                  <p><%=orderDetails.paymentMethod%><br>
                  Total: ₹<%=orderDetails.totalAmount%> 
                  
                  
                </div>
                <div class="col-lg-6">
                  <h3 class="h6">Billing address</h3>
                  <address>
                    <strong><%=orderDetails.deliveryDetails.fullname%></strong><br>
                    <%=orderDetails.deliveryDetails.houseName%><br>
                    <%=orderDetails.deliveryDetails.city%>, <%=orderDetails.deliveryDetails.pin%><br>
                     <%=orderDetails.deliveryDetails.mobile%>
                  </address>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
      </div>
  <script>
      
  function cancelOrder(id) {
    const orderId = id; // Assuming you're using `id` for the order
  
    Swal.fire({
      title: 'Are you sure you want to cancel this order?',
      text: 'This action cannot be undone.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes, cancel it',
      cancelButtonText: 'No, keep it'
    }).then((result) => {
      if (result.isConfirmed) {
        // User confirmed, proceed with the order cancellation
        $.ajax({
          url: '/cancelorder',
          method: 'POST',
          data: {
            orderId: orderId,
           
          },
          success: function (response) {
            if (response.success) {
              // Order cancellation was successful
          
              Swal.fire({
                icon: 'success',
                title: 'Order Canceled Successfully',
                text: 'Your order has been canceled.'
              }).then(() => {
                // Reload or redirect to a different page if needed
                
                // $("#re-load").load("/cancelorder #re-load");
           window.location.href = '/home'
                order.click();
              });
            } else {
              // Handle the case where cancellation was not successful
              Swal.fire({
                icon: 'error',
                title: 'Order Cancellation Failed',
                text: 'Unable to cancel the order at this time.'
              });
            }
          },
          error: function (error) {
            // Handle AJAX errors here
            console.error('Error canceling the order', error);
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'An error occurred while canceling the order.'
            });
          }
        });
      } else {
        // User clicked "No" or closed the dialog, do nothing
      }
    });
  }
  
  function download(){
    window.print();
  }
  
  </script>
  
  </div>
  </div>
  </div>
  


  <%-include("../layouts/admin/adminFooter.ejs")-%>