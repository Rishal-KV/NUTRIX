

<!DOCTYPE html>
<html>
  <head>
    <title>OTP Verification</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    />
    <!-- Add SweetAlert CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <style>
     @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700");
    * {
      border-radius: 0px !important;
      font-family: "Poppins", sans-serif;
    }

    body {
      background-color: #e1e1e1 !important;
      display: flex;
      align-items: center;
      height: 100vh;
    }

    .card {
      border: none !important;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: rgba(50, 50, 93, 0.25) 0px 6px 12px -2px,
        rgba(0, 0, 0, 0.3) 0px 3px 7px -3px;
    }

    .card-header {
      color: white !important;
      background:  #c96 !important;
      text-align: center;
    }

    .card-header > img {
      width: 180px;
    }

    .input-container input {
      width: 40px;
      height: 40px;
    }

    .form-control:focus {
      box-shadow: none !important;
      border: 1px solid  #c96 !important;
    }

    .verify-btn {
      border-radius: 20px !important;
      border: 0px !important;
      width: 140px;
      background-color:  #c96 !important;
    }
  </style>
  <body>
    <div class="container d-flex justify-content-center align-items-center">
      <div class="card text-center">
        <div class="card-header p-5">
          <h5 class="mb-2">OTP VERIFICATION</h5>
          <div>
            <small>code has been sent to <%= email ? email : "email" %></small>
          </div>
        </div>
        <div
          class="input-container d-flex flex-row justify-content-center mt-2"
        >
          <input
            type="text"
            class="m-1 text-center form-control rounded"
            maxlength="1"
            name="first"
          />
          <input
            type="text"
            class="m-1 text-center form-control rounded"
            maxlength="1"
            name="second"
          />
          <input
            type="text"
            class="m-1 text-center form-control rounded"
            maxlength="1"
            name="third"
          />
          <input
            type="text"
            class="m-1 text-center form-control rounded"
            maxlength="1"
            name="fourth"
          />
          <input
            type="text"
            class="m-1 text-center form-control rounded"
            maxlength="1"
            name="fifth"
          />
        </div>
       
        <div class="mt-3 mb-5">
          <button id="verifyButton" class="btn btn-success px-4 verify-btn">
            Verify
          </button>
          <button onclick="resend()" id="resendButton" class="btn btn-secondary px-4 verify-btn" disabled>
            Resend
          </button>
         <div>
          OTP expires with in :
          <span id="timer"> 60</span>
         </div> 
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        // Automatically select the next input field after one character is entered
        $("input[type='text']").on("input", function () {
          if (this.value.length === 1) {
            $(this).next("input[type='text']").focus();
          }
        });

        $("#verifyButton").click(function () {
          const first = $('input[name="first"]').val();
          const second = $('input[name="second"]').val();
          const third = $('input[name="third"]').val();
          const fourth = $('input[name="fourth"]').val();
          const fifth = $('input[name="fifth"]').val();

          $.ajax({
            type: "POST",
            url: "/confirm", // Replace with your server endpoint
            data: {
              first: first,
              second: second,
              third: third,
              fourth: fourth,
              fifth: fifth,
            },
            success: function (response) {
              if (response.success) {
                window.location.href = '/home';
              } else {
                Swal.fire({
                  icon: "error",
                  title: "Incorrect OTP",
                  text: "The OTP you entered is incorrect. Please try again.",
                });
              }
            },
            error: function (error) {
              console.error("Error:", error);
            },
          });
        });
      });

      let timerInterval;
      let countdown = 60;

      function startTimer() {
        $("#resendButton").prop("disabled", true);
        $("#resendLink").addClass("disabled");
        $("#timer").text(countdown);

        timerInterval = setInterval(function () {
          countdown--;
          $("#timer").text(countdown);

          if (countdown === 0) {
            clearInterval(timerInterval);
            $("#resendButton").prop("disabled", false);
            $("#resendLink").removeClass("disabled");
          }
        }, 1000);
      }

      startTimer();

      function resend(){
        console.log("hey");
        $.ajax({
          url : "/resend",
          method : "POST"
        })
      }

    </script>
  </body>
</html>
