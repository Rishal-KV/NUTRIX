<%- include("../layouts/user/userHeader.ejs")-%>

<main class="main">
    <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        <div class="container">
            <h1 class="page-title"><span>Shop</span></h1>
        </div><!-- End .container -->
    </div><!-- End .page-header -->
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
        <div class="container">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/home">Home</a></li>
                <li class="breadcrumb-item"><a href="/shop">Shop</a></li>
               
            </ol>
        </div><!-- End .container -->
    </nav><!-- End .breadcrumb-nav -->

    <div class="page-content">
        <div class="container">
            <div class="row">
                <div class="col-lg-9">
                    <div class="toolbox">
                        
                        <div class="toolbox-right">
                            <div class="dropdown">
                                <button style="background-color: transparent;" class="btn  border border-1  dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  Sort By
                                </button>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                  <a class="dropdown-item" href="/shop?id=1">Price : Low to Hight</a>
                                  <a class="dropdown-item" href="/shop?id=-1">Price : High to Low</a>
                                 
                                </div>
                              </div>


                            


                        </div><!-- End .toolbox-right -->
                    </div><!-- End .toolbox -->

                    <div class="products mb-3">
                        <div class="row">
                               <%product.forEach((val,index)=>{%>
                                <div class="col-6 col-md-4 col-lg-4">
                                    <div class="product product-7 text-center">
                                        <figure class="product-media">
                                            <a href="/productdetails?id=<%=val._id%>">
                                                <img src="/product/img/<%=val.image.image1%>" alt="Product image" class="product-image">
                                            </a>
    
                                            <div class="product-action-vertical">
                                                <%if(wishListStrin.includes(val._id.toString())){ %>
                                                    <a  onclick="Wishlist('<%=val._id%>')"><i class="fa-solid fa-heart"></i></a>
                                              <%  }else{ %>
                                             <a onclick="Wishlist('<%=val._id%>')"> <i class="fa-regular fa-heart"></i></a>  
                                            <%  } %>
                                              
                                             
                                            </div><!-- End .product-action-vertical -->
    
                                            <div class="product-action">
                                                <a onclick="addToCart('<%=val._id%>')" class="btn-product btn-cart"><span>add to cart</span></a>
                                            </div><!-- End .product-action -->
                                        </figure><!-- End .product-media -->
    
                                        <div class="product-body">
                                            <h3 class="product-title"><a href="/productdetails?id=<%=val._id%>"><%=val.name%></a></h3><!-- End .product-title -->
                                            <div class="product-price">
                                                ₹<%=val.price%>
                                            </div><!-- End .product-price -->
                                            <!-- <div class="ratings-container">
                                                <div class="ratings">
                                                    <div class="ratings-val" style="width: 0%;"></div>
                                                </div>
                                                <span class="ratings-text">( 0 Reviews )</span>
                                            </div> -->
                                            
                                        </div><!-- End .product-body -->
                                    </div><!-- End .product -->
                                </div><!-- End .col-sm-6 col-lg-4 -->
    
    
                              <% })%>
                            

                        </div><!-- End .row -->
                    </div><!-- End .products -->

                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center">
                            <%for(let i = 1; i <= pages; i++){%>
                                <li class="border <%= i == pageNum ? 'active bg-primary' : 'border-1 border-1 ' %>" aria-current="page">
                                    <a  class="page-link <%= i == pageNum ? 'text-white' : 'text-dark' %>" href="/shop?page=<%=i%>"><%=i%></a>
                                  </li>
                                  
                            <%}%>
                           
                            
                           
                        </ul>
                    </nav>
                </div><!-- End .col-lg-9 -->
                <aside class="col-lg-3 order-lg-first">
                    <div class="sidebar sidebar-shop">
                        <div class="widget widget-clean">
                            <label>Filters:</label>
                            
                        </div><!-- End .widget widget-clean -->

                        <form >

                  
                            <div class="widget widget-collapsible">
                                <h3 class="widget-title">
                                    <a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true" aria-controls="widget-1">
                                        Category
                                    </a>
                                </h3><!-- End .widget-title -->
    
                                <div class="collapse show" id="widget-1">
                                    <div class="widget-body">
                                        <div class="filter-items">
                                           
    



                                        <%category.forEach((cat,index)=>{%>
                                            <div class="filter-item">
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="category-<%=index+1%>" name="category" >
                                                    <label class="custom-control-label" for="category-<%=index+1%>"><%=cat.name%></label>
                                                </div><!-- End .custom-checkbox -->
                                            </div><!-- End .filter-item -->
                                        <%})%>
                        
                                           
    
                                           
    
                                            
    
                                            
    
                                         
    
                                        </div><!-- End .filter-items -->
                                    </div><!-- End .widget-body -->
                                </div><!-- End .collapse -->
                            </div><!-- End .widget -->
    
                           

                    

                        <div class="widget widget-collapsible">
                            <h3 class="widget-title">
                                <a data-toggle="collapse" href="#widget-2" role="button" aria-expanded="true" aria-controls="widget-2">
                                    Price
                                </a>
                            </h3><!-- End .widget-title -->

                            <div class="collapse show" id="widget-2">
                                <div class="widget-body">
                                    <div class="filter-items">
                                       

                                        

                                        <div class="filter-item">
                                            <div class="custom-control custom-radio">
                                                <input type="radio" class="custom-control-input" id="Price1" value="100-999" name="price">
                                                <label class="custom-control-label" for="Price1">₹100-₹999</label>
                                            </div><!-- End .custom-checkbox -->
                                        </div><!-- End .filter-item -->

                                        <div class="filter-item">
                                            <div class="custom-control custom-radio">
                                                <input type="radio" class="custom-control-input" id="Price2" value="1000-4999" name="price">
                                                <label class="custom-control-label" for="Price2">₹1000-₹4999</label>
                                            </div><!-- End .custom-checkbox -->
                                        </div><!-- End .filter-item -->

                                        <div class="filter-item">
                                            <div class="custom-control custom-radio">
                                                <input type="radio" class="custom-control-input" id="Price3" value="5000-7999" name="price">
                                                <label class="custom-control-label" for="Price3">₹5000-₹7999</label>
                                            </div><!-- End .custom-checkbox -->
                                        </div><!-- End .filter-item -->


                                        

                                        

                                        

                                    </div><!-- End .filter-items -->
                                </div><!-- End .widget-body -->
                            </div><!-- End .collapse -->
                        </div><!-- End .widget -->



                
                        <div>
                            <button class="btn btn-primary" type="submit">Filter</button>
                        </div>
                    </form>
                    </div><!-- End .sidebar sidebar-shop -->
                </aside><!-- End .col-lg-3 -->
            </div><!-- End .row -->
        </div><!-- End .container -->
    </div><!-- End .page-content -->
</main><!-- End .main -->
<script>
    function addToCart(productId) {
         
      $.ajax({
        url: "/addtoCart",
        method: "post",
        data: {
          id: productId,
        },
        success: (response) => {
          if (response.login == true) {
            swal
              .fire({
                icon: "warning",
                title: "Please Login",
                confirmButtonColor: "#3085d6",
                confirmButtonText: "Login",
                showCancelButton: true,
                cancelButtonColor: "#d33",
                text: response.message,
              })
              .then((result) => {
                if (result.isConfirmed) {
                  window.location.href = "/login";
                }
              });
          } else if (response.success) {
            swal.fire({
              position: "center",
              icon: "success",
              title: "Product added to cart",
              showConfirmButton: false,
              timer: 1500,
            }).then(()=>{
                window.location.href = "/shop"
            });
          }else if(response.exist){

            Swal.fire({
      icon: 'warning',
      title: 'Item Already in Cart',
      text: 'This item is already in your cart.',
    });
          }else if(response.outofstock){
            swal.fire({
              position: "center",
              icon: "error",
              title: "Out of stock",
              showConfirmButton: false,
              timer: 1500,
            });
          }
        },
      });
    }


 function Wishlist(productId){
        $.ajax({
            url : '/addtowishlist',
            type : 'POST',
            data :{
                productId : productId
            },
            success : function(response){
                if (response.added) {
                 location.reload();
                }else if(response.removed){
                location.reload()
            }
            }
        })
    }
    
  </script>
<%- include("../layouts/user/userFooter.ejs")-%>